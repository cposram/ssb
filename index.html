<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è›‹è›‹æ˜æ˜Ÿå¤§äº‚é¬¥ - ç«¶æŠ€å ´ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #222;
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            touch-action: manipulation;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        canvas {
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 0 30px rgba(0,0,0,0.7);
            max-width: 100%;
            max-height: 70vh;
            border: 5px solid #fff;
            border-radius: 10px;
        }
        /* UI ä»‹é¢ */
        #ui-overlay {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            pointer-events: none;
        }
        .hp-bar-outer { width: 180px; height: 25px; background: #333; border: 3px solid #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .hp-fill { width: 100%; height: 100%; background: #2ed573; transition: width 0.3s ease; }
        .label { color: white; text-shadow: 2px 2px 4px black; text-align: center; margin-bottom: 5px; font-weight: bold; font-size: 18px; }

        /* çµç®—ç•«é¢ */
        #result-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none; /* é è¨­éš±è— */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            text-align: center;
        }
        #result-title { font-size: 60px; margin-bottom: 20px; text-shadow: 0 0 20px gold; }
        #award-icon { font-size: 100px; margin-bottom: 20px; }
        .restart-btn {
            padding: 15px 40px;
            font-size: 24px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #b33939;
            transition: 0.2s;
        }
        .restart-btn:hover { background: #ff6b81; transform: translateY(-3px); }
        .restart-btn:active { transform: translateY(2px); box-shadow: none; }

        /* æ‰‹æ©Ÿæ§åˆ¶ */
        #controls {
            display: flex;
            justify-content: space-between;
            width: 95%;
            max-width: 600px;
            margin-top: 15px;
        }
        .btn-group { display: flex; gap: 15px; }
        .ctrl-btn {
            width: 70px; height: 70px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 24px;
            user-select: none; border: 3px solid #444;
        }
        .attack-btn { background: #ff4757; color: white; width: 80px; height: 80px; font-size: 28px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-overlay">
        <div>
            <div class="label">ç©å®¶ ğŸ¥š</div>
            <div class="hp-bar-outer"><div id="p1-hp" class="hp-fill"></div></div>
        </div>
        <div>
            <div class="label">é›»è…¦ ğŸ¤–</div>
            <div class="hp-bar-outer"><div id="p2-hp" class="hp-fill" style="background: #ffa502;"></div></div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="result-screen">
        <div id="award-icon">ğŸ†</div>
        <div id="result-title">ä½ è´äº†ï¼</div>
        <button class="restart-btn" onclick="resetGame()">å†æˆ°ä¸€å ´</button>
    </div>

    <div id="controls">
        <div class="btn-group">
            <div class="ctrl-btn" id="btn-left">â†</div>
            <div class="ctrl-btn" id="btn-right">â†’</div>
        </div>
        <div class="btn-group">
            <div class="ctrl-btn" id="btn-jump">è·³</div>
            <div class="ctrl-btn attack-btn" id="btn-attack">âš”ï¸</div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const resultScreen = document.getElementById('result-screen');
    const resultTitle = document.getElementById('result-title');
    const awardIcon = document.getElementById('award-icon');

    canvas.width = 800;
    canvas.height = 500;

    const gravity = 0.8;
    const friction = 0.8;
    let gameActive = true;

    const platforms = [
        { x: 150, y: 380, w: 500, h: 25 }, 
        { x: 80, y: 240, w: 160, h: 15 }, 
        { x: 560, y: 240, w: 160, h: 15 }, 
        { x: 325, y: 130, w: 150, h: 15 }
    ];

    class Egg {
        constructor(x, y, color, isNPC) {
            this.initialX = x;
            this.initialY = y;
            this.reset();
            this.color = color;
            this.isNPC = isNPC;
            this.width = 40;
            this.height = 50;
        }

        reset() {
            this.x = this.initialX;
            this.y = this.initialY;
            this.dx = 0;
            this.dy = 0;
            this.hp = 100;
            this.facing = this.isNPC ? -1 : 1;
            this.isAttacking = false;
            this.attackCooldown = 0;
            this.jumpCount = 0;
        }

        draw() {
            if (this.isAttacking) {
                ctx.fillStyle = "#f1f2f6";
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                ctx.rotate(this.facing * Math.PI / 4);
                ctx.fillRect(0, -5, 55 * this.facing, 10);
                ctx.restore();
            }

            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.ellipse(this.x + this.width/2, this.y + this.height/2, this.width/2, this.height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 3;
            ctx.stroke();

            // çœ¼ç›
            ctx.fillStyle = "#000";
            let eyeX = this.x + (this.facing === 1 ? 25 : 10);
            ctx.beginPath();
            ctx.arc(eyeX, this.y + 15, 4, 0, Math.PI * 2);
            ctx.fill();
        }

        update() {
            this.dy += gravity;
            this.x += this.dx;
            this.y += this.dy;
            this.dx *= friction;

            platforms.forEach(p => {
                if (this.x + this.width > p.x && this.x < p.x + p.w &&
                    this.y + this.height > p.y && this.y + this.height < p.y + p.h + this.dy) {
                    if (this.dy >= 0) {
                        this.dy = 0;
                        this.y = p.y - this.height;
                        this.jumpCount = 0;
                    }
                }
            });

            if (this.x < 0) this.x = 0;
            if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
            if (this.y > canvas.height) { // æ‘”è½
                this.hp -= 20; 
                this.y = 0;
                this.dx = 0;
                updateHPUI();
            }

            if (this.attackCooldown > 0) this.attackCooldown--;
            if (this.attackCooldown < 15) this.isAttacking = false;
        }

        attack() {
            if (this.attackCooldown === 0) {
                this.isAttacking = true;
                this.attackCooldown = 30;
                return true;
            }
            return false;
        }
    }

    const player = new Egg(200, 300, "#ffffff", false);
    const npc = new Egg(550, 300, "#f1c40f", true);

    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // æ‰‹æ©Ÿæ§åˆ¶
    let mobileLeft = false, mobileRight = false;
    function bindBtn(id, down, up) {
        const el = document.getElementById(id);
        el.addEventListener('touchstart', e => { e.preventDefault(); down(); });
        el.addEventListener('touchend', e => { e.preventDefault(); if(up) up(); });
    }
    bindBtn('btn-left', () => mobileLeft = true, () => mobileLeft = false);
    bindBtn('btn-right', () => mobileRight = true, () => mobileRight = false);
    bindBtn('btn-jump', () => { if(player.jumpCount < 2) { player.dy = -13; player.jumpCount++; } });
    bindBtn('btn-attack', () => player.attack());

    function updateHPUI() {
        document.getElementById('p1-hp').style.width = Math.max(0, player.hp) + '%';
        document.getElementById('p2-hp').style.width = Math.max(0, npc.hp) + '%';
    }

    function checkHit(attacker, victim) {
        if (attacker.isAttacking && attacker.attackCooldown === 25) {
            const hitRange = 65;
            const attackerMidX = attacker.x + attacker.width/2;
            const reach = attackerMidX + (attacker.facing * hitRange);
            
            if (victim.x < Math.max(attackerMidX, reach) && 
                victim.x + victim.width > Math.min(attackerMidX, reach) &&
                Math.abs(attacker.y - victim.y) < 60) {
                
                victim.hp -= 15;
                victim.dx = attacker.facing * 18; // å¼·åŠ›æ“Šé£›
                victim.dy = -6;
                updateHPUI();
            }
        }
    }

    function updateAI() {
        const dist = player.x - npc.x;
        if (Math.abs(dist) > 70) {
            npc.dx = dist > 0 ? 3.5 : -3.5;
            npc.facing = dist > 0 ? 1 : -1;
        } else {
            if (Math.random() < 0.06) npc.attack();
        }
        if (Math.random() < 0.01 && npc.jumpCount === 0) npc.dy = -12;
    }

    function showEndScreen(winner) {
        gameActive = false;
        resultScreen.style.display = 'flex';
        if (winner === 'player') {
            awardIcon.innerHTML = "ğŸ†";
            resultTitle.innerHTML = "å‹åˆ©ï¼è›‹ç‹èª•ç”Ÿ";
            resultTitle.style.color = "gold";
        } else {
            awardIcon.innerHTML = "ğŸ¥š";
            resultTitle.innerHTML = "å¤§å¤±æ•—...è¢«ç…®äº†";
            resultTitle.style.color = "#ff4757";
        }
    }

    function resetGame() {
        player.reset();
        npc.reset();
        updateHPUI();
        resultScreen.style.display = 'none';
        gameActive = true;
        gameLoop();
    }

    function gameLoop() {
        if (!gameActive) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // æ§åˆ¶
        if (keys['ArrowLeft'] || mobileLeft) { player.dx = -6; player.facing = -1; }
        if (keys['ArrowRight'] || mobileRight) { player.dx = 6; player.facing = 1; }
        if (keys['Space'] || keys['ArrowUp']) { if(player.jumpCount === 0) { player.dy = -13; player.jumpCount = 1; } }
        if (keys['KeyZ']) player.attack();

        updateAI();
        player.update();
        npc.update();

        checkHit(player, npc);
        checkHit(npc, player);

        // ç•«å°éš
        ctx.fillStyle = "#2f3542";
        platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

        player.draw();
        npc.draw();

        // åˆ¤æ–·å‹è² 
        if (player.hp <= 0) showEndScreen('npc');
        else if (npc.hp <= 0) showEndScreen('player');
        else requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>
</body>
</html>

